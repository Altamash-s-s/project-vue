{"version":3,"sources":["webpack:///./helpers/asyncLocalStorage.ts","webpack:///./modules/customer/getters/addressGetter.ts","webpack:///./helpers/checkout/steps.ts","webpack:///./helpers/checkout/address.ts","webpack:///./modules/customer/getters/userShippingGetters.ts","webpack:///./modules/checkout/pages/Checkout/Shipping.vue?81ad","webpack:///./modules/checkout/pages/Checkout/Shipping.vue?fcf6","webpack:///./modules/checkout/pages/Checkout/Shipping.vue?14e6","webpack:///./modules/checkout/pages/Checkout/Shipping.vue?c91d","webpack:///./modules/checkout/pages/Checkout/Shipping.vue"],"names":["getVsfKey","key","createPromise","getValue","callback","Promise","resolve","reject","value","err","getItem","JSON","parse","window","localStorage","removeItem","mergeItem","oldValue","oldObject","newObject","nextValue","stringify","setItem","mergeLocalStorageItem","countriesList","countries","filter","c","id","full_name_english","full_name_locale","map","label","englishLabel","abbreviation","two_letter_abbreviation","sort","a","b","localeCompare","regionList","country","available_regions","code","name","isPreviousStepValid","stepToValidate","checkout","formatAddressReturnToData","address","firstname","lastname","street","apartment","city","region","country_code","postcode","telephone","addressFromApiToForm","region_code","getInitialCheckoutAddressForm","findUserAddressIdenticalToSavedCartAddress","customerAddresses","cartAddress","find","userAddress","isEqual","userShippingGetters","getAddresses","shipping","criteria","Logger","debug","addresses","Object","keys","length","entries","every","getDefault","default_shipping","getTotal","getPostCode","getStreetName","Array","isArray","getApartmentNumber","getCity","getFirstName","getLastName","getCountry","getPhone","phone","getEmail","email","getProvince","getCompanyName","company","getId","isDefault","extend","required","message","min","digits","defineComponent","components","SfHeading","SfInput","SfButton","SfSelect","ValidationProvider","ValidationObserver","UserShippingAddresses","VsfShippingProvider","setup","router","useRouter","app","useContext","userShipping","ref","load","loadShipping","save","saveShipping","loading","isShippingLoading","useShipping","loadUserShipping","setDefaultAddress","useUserAddress","loadCountries","search","searchCountry","useCountrySearch","isAuthenticated","useUser","shippingDetails","shippingMethods","currentAddressId","isSetAsDefaultRequested","isFormSubmitted","isAddNewAddressFormVisible","isShippingDetailsStepCompleted","computed","canMoveForward","hasSavedShippingAddress","addressGetter","regionInformation","handleSetCurrentAddress","customerAddress","changeShippingDetails","field","changeCountry","newCountry","onMounted","push","localeRoute","loadedShippingInfoBoundToCart","loadedUserShipping","loadedCountries","all","defaultAddress","Boolean","userAddressIdenticalToSavedCartAddress","handleAddNewAddressBtnClick","handleAddressSubmit","reset","addressId","shippingDetailsData","customerAddressId","save_in_address_book","shippingInfo","available_shipping_methods","chosenAddress","component","_vm","this","_h","$createElement","_c","_self","scopedSlots","_u","fn","handleSubmit","dirty","directives","rawName","expression","staticClass","attrs","$t","_v","_e","on","$event","preventDefault","model","$$v","errors","_l","regionOption","_s","countryOption","$set","$router"],"mappings":"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","file":"4bdb7f7.modern.js","sourcesContent":["const getVsfKey = (key: string) => `vsf-${key}`;\n\ntype Callback<TValue> = (error: Error | null, value?: TValue) => void;\n\nconst mergeLocalStorageItem = (key: string, value: Record<string, unknown>) : void => {\n  const oldValue = window.localStorage.getItem(key);\n  const oldObject = JSON.parse(oldValue);\n  const newObject = value;\n  const nextValue = JSON.stringify({\n    ...JSON.parse(JSON.stringify(oldObject)),\n    ...JSON.parse(JSON.stringify(newObject)),\n  });\n  window.localStorage.setItem(key, nextValue);\n};\n\nconst createPromise = <TValue>(\n  getValue: () => TValue,\n  callback: Callback<TValue>,\n) : Promise<TValue> => new Promise((resolve, reject) => {\n  try {\n    const value = getValue();\n    if (callback) {\n      callback(null, value);\n    }\n    resolve(value);\n  } catch (err) {\n    if (callback) {\n      callback(err as Error);\n    }\n    reject(err);\n  }\n});\n\nexport const getItem = <T = unknown>(\n  key: string,\n  callback?: Callback<T>,\n): Promise<T> => createPromise(() => JSON.parse(window.localStorage.getItem(getVsfKey(key))), callback);\n\nexport const setItem = <T = unknown>(\n  key: string,\n  value: T,\n  callback?: Callback<void>,\n): Promise<void> => createPromise(() => (window.localStorage.setItem(getVsfKey(key), JSON.stringify(value))), callback);\n\nexport const removeItem = (\n  key: string,\n  callback?: Callback<void>,\n): Promise<void> => createPromise(() => {\n  window.localStorage.removeItem(getVsfKey(key));\n}, callback);\n\nexport const mergeItem = (\n  key: string,\n  value: Record<string, unknown>,\n  callback?: Callback<void>,\n): Promise<void> => createPromise(() => mergeLocalStorageItem(getVsfKey(key), value), callback);\n\nexport const clear = (callback?: Callback<void>): Promise<void> => createPromise(() => {\n  window.localStorage.clear();\n}, callback);\n","import { AddressGetter } from '~/modules/customer/getters/types';\nimport { Countries } from '~/composables';\nimport { Country } from '~/modules/GraphQL/types';\n\nconst countriesList: AddressGetter['countriesList'] = (countries: Countries[]) => countries\n  .filter((c) => c.id && c.full_name_english && c.full_name_locale)\n  .map((c) => ({\n    id: c.id,\n    label: c.full_name_locale,\n    englishLabel: c.full_name_english,\n    abbreviation: c.two_letter_abbreviation,\n  }))\n  .sort((a, b) => a.label.localeCompare(b.label));\n\nconst regionList: AddressGetter['regionList'] = (country: Country) => (country?.available_regions ? country.available_regions\n  .filter((c) => c.id && c.code && c.name)\n  .map((c) => ({\n    id: c.id,\n    label: c.name,\n    abbreviation: c.code,\n  } as {\n    id: number;\n    label: string;\n    abbreviation: string;\n  }))\n  .sort((a, b) => a.label.localeCompare(b.label)) : []);\n\nexport default {\n  countriesList,\n  regionList,\n} as AddressGetter;\n","import { getItem } from '~/helpers/asyncLocalStorage';\n\nexport const isPreviousStepValid = async (stepToValidate: string) => {\n  const checkout = await getItem('checkout');\n  return !(!checkout || !checkout[stepToValidate]);\n};\n","import { isEqual } from 'lodash-es';\nimport type { CustomerAddress, CartAddressInterface } from '~/modules/GraphQL/types';\n\nexport const formatAddressReturnToData = (address: CartAddressInterface) => ({\n  firstname: address.firstname,\n  lastname: address.lastname,\n  street: address.street[0],\n  apartment: address.street[1],\n  city: address.city,\n  region: address.region.code,\n  country_code: address.country.code,\n  postcode: address.postcode,\n  telephone: address.telephone,\n});\n\n/**\n * Converts addresses that were:\n * * added to the logged in user's account\n * * saved in the cart (eg. completed the shipping address step and saved in the Checkout page, then went to some other page)\n * into the form data format used by Billing and Shipping forms in the Checkout page\n */\nexport const addressFromApiToForm = (address: CustomerAddress | CartAddressInterface) : CheckoutAddressForm => ({\n  firstname: address.firstname,\n  lastname: address.lastname,\n  street: address.street?.[0],\n  apartment: address.street?.[1],\n  city: address.city,\n  region: (address as CustomerAddress)?.region?.region_code ?? (address as CartAddressInterface).region.code,\n  country_code: (address as CustomerAddress)?.country_code ?? (address as CartAddressInterface).country.code,\n  postcode: address.postcode,\n  telephone: address.telephone,\n});\n\nexport interface CheckoutAddressForm {\n  firstname: string;\n  lastname: string;\n  street: string;\n  apartment: string;\n  city: string;\n  region: string;\n  country_code: string;\n  postcode: string;\n  telephone: string;\n}\n\nexport const getInitialCheckoutAddressForm = () : CheckoutAddressForm => ({\n  firstname: '',\n  lastname: '',\n  street: '',\n  apartment: '',\n  city: '',\n  region: '',\n  country_code: '',\n  postcode: '',\n  telephone: '',\n});\n\n/**\n * Try to find an address from the user's saved addresses that exactly matches the address that is bound to a cart.\n *\n * `useShipping().save()``sends an addressId to Magento to set the shipping address on the cart,\n * but when you download the cart after that - the cart's endpoint response doesn't contain that addressId, just the address fields (street etc.)\n * So the only choice left is to try to compare the fields of the addresses.\n *\n * This function exists because if a user returns to a cart whose shipping address was set before, we want the user address to be highlighted in the SfAddressPicker component.\n *\n * @param customerAddresses The addresses saved in a user's account\n * @param cartAddress The address that is bound to the cart, @see Cart[\"billing_address\"] Cart[\"shipping_addresses\"]\n *\n */\nexport const findUserAddressIdenticalToSavedCartAddress = (\n  customerAddresses: CustomerAddress[] | null,\n  cartAddress: CartAddressInterface,\n) : CustomerAddress => customerAddresses?.find(\n  (userAddress) => isEqual(addressFromApiToForm(userAddress), addressFromApiToForm(cartAddress)),\n) ?? null;\n","import { UserShippingGetters } from '~/modules/customer/getters/types';\nimport { Customer, CustomerAddress } from '~/modules/GraphQL/types';\nimport { Logger } from '~/helpers/logger';\nimport { TransformedCustomerAddress } from '../composables/types';\n\nconst userShippingGetters: UserShippingGetters<Customer, CustomerAddress, TransformedCustomerAddress> = {\n  getAddresses: (shipping, criteria?: Record<string, any>) => {\n    Logger.debug(shipping);\n    if (!shipping || !shipping.addresses) return [] as CustomerAddress[];\n\n    if (!criteria || Object.keys(criteria).length === 0) {\n      return shipping.addresses;\n    }\n\n    const entries = Object.entries(criteria);\n    return shipping.addresses.filter((address) => entries.every(([key, value]: [ keyof CustomerAddress, unknown ]) => address[key] === value));\n  },\n  getDefault: (shipping) => shipping.addresses.find(({ default_shipping }) => default_shipping),\n  getTotal: (shipping) => shipping.addresses.length,\n  getPostCode: (address) => address?.postcode || '',\n  getStreetName: (address) => (Array.isArray(address?.street) ? address?.street[0] : ''),\n  getApartmentNumber: (address) => (Array.isArray(address?.street) ? address?.street[1] : ''),\n  getCity: (address) => address?.city || '',\n  getFirstName: (address) => address?.firstname || '',\n  getLastName: (address) => address?.lastname || '',\n  getCountry: (address) => address?.country_code || '',\n  getPhone: (address) => address?.phone || '',\n  getEmail: (address) => address?.email || '',\n  getProvince: (address) => (address?.region?.region_code || address?.region?.region) || '',\n  getCompanyName: (address) => address?.company || '',\n  getId: (address) => address?.id || '',\n  isDefault: (address) => address?.default_shipping || false,\n};\n\nexport default userShippingGetters;\n","export * from \"-!../../../../node_modules/extract-css-chunks-webpack-plugin/dist/loader.js??ref--7-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--7-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--7-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--7-oneOf-1-3!../../../../node_modules/sass-resources-loader/lib/loader.js??ref--7-oneOf-1-4!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../../../node_modules/unplugin/dist/webpack/loaders/transform.js??ref--15-0!./Shipping.vue?vue&type=style&index=0&id=4120bf6e&prod&lang=scss&scoped=true&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ValidationObserver',{scopedSlots:_vm._u([{key:\"default\",fn:function(ref){\nvar handleSubmit = ref.handleSubmit;\nvar dirty = ref.dirty;\nvar reset = ref.reset;\nreturn [_c('SfHeading',{directives:[{name:\"e2e\",rawName:\"v-e2e\",value:('shipping-heading'),expression:\"'shipping-heading'\"}],staticClass:\"sf-heading--left sf-heading--no-underline title\",attrs:{\"level\":3,\"title\":_vm.$t('Shipping address')}}),_vm._v(\" \"),(_vm.hasSavedShippingAddress)?_c('SfHeading',{directives:[{name:\"e2e\",rawName:\"v-e2e\",value:('shipping-heading'),expression:\"'shipping-heading'\"}],staticClass:\"sf-heading--left sf-heading--no-underline form-subtitle\",attrs:{\"level\":4,\"title\":_vm.$t('Select previously saved address')}}):_vm._e(),_vm._v(\" \"),_c('form',{on:{\"submit\":function($event){$event.preventDefault();handleSubmit(_vm.handleAddressSubmit(reset))}}},[(_vm.isAuthenticated && _vm.hasSavedShippingAddress)?_c('UserShippingAddresses',{directives:[{name:\"e2e\",rawName:\"v-e2e\",value:('shipping-addresses'),expression:\"'shipping-addresses'\"}],attrs:{\"current-address-id\":_vm.currentAddressId,\"shipping-addresses\":_vm.addresses,\"countries\":_vm.countries},on:{\"setCurrentAddress\":function($event){return _vm.handleSetCurrentAddress($event)}},model:{value:(_vm.isSetAsDefaultRequested),callback:function ($$v) {_vm.isSetAsDefaultRequested=$$v},expression:\"isSetAsDefaultRequested\"}}):_vm._e(),_vm._v(\" \"),(_vm.isAddNewAddressFormVisible)?_c('div',{staticClass:\"form\"},[(_vm.hasSavedShippingAddress)?_c('SfHeading',{directives:[{name:\"e2e\",rawName:\"v-e2e\",value:('shipping-heading'),expression:\"'shipping-heading'\"}],staticClass:\"sf-heading--left sf-heading--no-underline form-subtitle\",attrs:{\"level\":4,\"title\":_vm.$t('Enter different address')}}):_vm._e(),_vm._v(\" \"),_c('ValidationProvider',{attrs:{\"name\":\"firstname\",\"rules\":\"required|min:2\",\"slim\":\"\"},scopedSlots:_vm._u([{key:\"default\",fn:function(ref){\nvar errors = ref.errors;\nreturn [_c('SfInput',{directives:[{name:\"e2e\",rawName:\"v-e2e\",value:('shipping-firstName'),expression:\"'shipping-firstName'\"}],staticClass:\"form__element form__element--half\",attrs:{\"value\":_vm.shippingDetails.firstname,\"label\":_vm.$t('First Name'),\"name\":\"firstName\",\"required\":\"\",\"valid\":!errors[0],\"error-message\":_vm.$t(errors[0])},on:{\"input\":function($event){return _vm.changeShippingDetails('firstname', $event)}}})]}}],null,true)}),_vm._v(\" \"),_c('ValidationProvider',{attrs:{\"name\":\"lastname\",\"rules\":\"required|min:2\",\"slim\":\"\"},scopedSlots:_vm._u([{key:\"default\",fn:function(ref){\nvar errors = ref.errors;\nreturn [_c('SfInput',{directives:[{name:\"e2e\",rawName:\"v-e2e\",value:('shipping-lastName'),expression:\"'shipping-lastName'\"}],staticClass:\"form__element form__element--half form__element--half-even\",attrs:{\"value\":_vm.shippingDetails.lastname,\"label\":_vm.$t('Last Name'),\"name\":\"lastName\",\"required\":\"\",\"valid\":!errors[0],\"error-message\":_vm.$t(errors[0])},on:{\"input\":function($event){return _vm.changeShippingDetails('lastname', $event)}}})]}}],null,true)}),_vm._v(\" \"),_c('ValidationProvider',{attrs:{\"name\":\"street\",\"rules\":\"required\",\"slim\":\"\"},scopedSlots:_vm._u([{key:\"default\",fn:function(ref){\nvar errors = ref.errors;\nreturn [_c('SfInput',{directives:[{name:\"e2e\",rawName:\"v-e2e\",value:('shipping-streetName'),expression:\"'shipping-streetName'\"}],staticClass:\"form__element form__element--half\",attrs:{\"value\":_vm.shippingDetails.street,\"label\":_vm.$t('Street Name'),\"name\":\"streetName\",\"required\":\"\",\"valid\":!errors[0],\"error-message\":_vm.$t(errors[0])},on:{\"input\":function($event){return _vm.changeShippingDetails('street', $event)}}})]}}],null,true)}),_vm._v(\" \"),_c('ValidationProvider',{attrs:{\"name\":\"apartment\",\"rules\":\"required|min:1\",\"slim\":\"\"},scopedSlots:_vm._u([{key:\"default\",fn:function(ref){\nvar errors = ref.errors;\nreturn [_c('SfInput',{directives:[{name:\"e2e\",rawName:\"v-e2e\",value:('shipping-apartment'),expression:\"'shipping-apartment'\"}],staticClass:\"form__element form__element--half form__element--half-even\",attrs:{\"value\":_vm.shippingDetails.apartment,\"label\":_vm.$t('House/Apartment number'),\"name\":\"apartment\",\"required\":\"\",\"valid\":!errors[0],\"error-message\":_vm.$t(errors[0])},on:{\"input\":function($event){return _vm.changeShippingDetails('apartment', $event)}}})]}}],null,true)}),_vm._v(\" \"),_c('ValidationProvider',{attrs:{\"name\":\"city\",\"rules\":\"required|min:2\",\"slim\":\"\"},scopedSlots:_vm._u([{key:\"default\",fn:function(ref){\nvar errors = ref.errors;\nreturn [_c('SfInput',{directives:[{name:\"e2e\",rawName:\"v-e2e\",value:('shipping-city'),expression:\"'shipping-city'\"}],staticClass:\"form__element form__element--half\",attrs:{\"value\":_vm.shippingDetails.city,\"label\":_vm.$t('City'),\"name\":\"city\",\"required\":\"\",\"valid\":!errors[0],\"error-message\":_vm.$t(errors[0])},on:{\"input\":function($event){return _vm.changeShippingDetails('city', $event)}}})]}}],null,true)}),_vm._v(\" \"),_c('ValidationProvider',{attrs:{\"name\":\"region\",\"rules\":!_vm.shippingDetails.country_code || _vm.regionInformation.length === 0\n            ? null\n            : 'required|min:2',\"slim\":\"\"},scopedSlots:_vm._u([{key:\"default\",fn:function(ref){\n            var errors = ref.errors;\nreturn [(\n            !_vm.shippingDetails.country_code || _vm.regionInformation.length === 0\n          )?_c('SfInput',{directives:[{name:\"e2e\",rawName:\"v-e2e\",value:('shipping-state'),expression:\"'shipping-state'\"}],staticClass:\"form__element form__element--half form__element--half-even\",attrs:{\"value\":_vm.shippingDetails.region,\"label\":_vm.$t('State/Province'),\"disabled\":!_vm.shippingDetails.country_code,\"name\":\"state\",\"valid\":!!_vm.shippingDetails.country_code,\"error-message\":!_vm.shippingDetails.country_code\n              ? _vm.$t('Please select a country first')\n              : ''},on:{\"input\":function($event){return _vm.changeShippingDetails('region', $event)}}}):_c('SfSelect',{directives:[{name:\"e2e\",rawName:\"v-e2e\",value:('shipping-state'),expression:\"'shipping-state'\"}],staticClass:\"form__element form__element--half form__element--half-even form__select sf-select--underlined\",attrs:{\"value\":_vm.shippingDetails.region,\"label\":_vm.$t('State/Province'),\"name\":\"state\",\"valid\":!errors[0],\"error-message\":_vm.$t(errors[0])},on:{\"input\":function($event){return _vm.changeShippingDetails('region', $event)}}},[_c('SfSelectOption',{attrs:{\"value\":''}}),_vm._v(\" \"),_vm._l((_vm.regionInformation),function(regionOption){return _c('SfSelectOption',{key:regionOption.id,attrs:{\"value\":regionOption.abbreviation}},[_vm._v(\"\\n            \"+_vm._s(regionOption.label)+\"\\n          \")])})],2)]}}],null,true)}),_vm._v(\" \"),_c('ValidationProvider',{attrs:{\"name\":\"country\",\"rules\":\"required|min:2\",\"slim\":\"\"},scopedSlots:_vm._u([{key:\"default\",fn:function(ref){\n              var errors = ref.errors;\nreturn [_c('SfSelect',{directives:[{name:\"e2e\",rawName:\"v-e2e\",value:('shipping-country'),expression:\"'shipping-country'\"}],staticClass:\"form__element form__element--half form__select sf-select--underlined\",attrs:{\"value\":_vm.shippingDetails.country_code,\"label\":_vm.$t('Country'),\"name\":\"country\",\"required\":\"\",\"valid\":!errors[0],\"error-message\":_vm.$t(errors[0])},on:{\"input\":_vm.changeCountry}},[_c('SfSelectOption',{attrs:{\"value\":''}}),_vm._v(\" \"),_vm._l((_vm.countriesList),function(countryOption){return _c('SfSelectOption',{key:countryOption.id,attrs:{\"value\":countryOption.abbreviation}},[_vm._v(\"\\n            \"+_vm._s(countryOption.label)+\"\\n          \")])})],2)]}}],null,true)}),_vm._v(\" \"),_c('ValidationProvider',{attrs:{\"name\":\"zipCode\",\"rules\":\"required|min:2\",\"slim\":\"\"},scopedSlots:_vm._u([{key:\"default\",fn:function(ref){\n              var errors = ref.errors;\nreturn [_c('SfInput',{directives:[{name:\"e2e\",rawName:\"v-e2e\",value:('shipping-zipcode'),expression:\"'shipping-zipcode'\"}],staticClass:\"form__element form__element--half form__element--half-even\",attrs:{\"value\":_vm.shippingDetails.postcode,\"label\":_vm.$t('Zip-code'),\"name\":\"zipCode\",\"required\":\"\",\"valid\":!errors[0],\"error-message\":_vm.$t(errors[0])},on:{\"input\":function($event){return _vm.changeShippingDetails('postcode', $event)}}})]}}],null,true)}),_vm._v(\" \"),_c('ValidationProvider',{attrs:{\"name\":\"phone\",\"rules\":\"required|min:8\",\"slim\":\"\"},scopedSlots:_vm._u([{key:\"default\",fn:function(ref){\n              var errors = ref.errors;\nreturn [_c('SfInput',{directives:[{name:\"e2e\",rawName:\"v-e2e\",value:('shipping-phone'),expression:\"'shipping-phone'\"}],staticClass:\"form__element form__element--half\",attrs:{\"label\":_vm.$t('Phone number'),\"name\":\"phone\",\"required\":\"\",\"valid\":!errors[0],\"error-message\":_vm.$t(errors[0])},on:{\"input\":function($event){return _vm.changeShippingDetails('telephone', $event)}},model:{value:(_vm.shippingDetails.telephone),callback:function ($$v) {_vm.$set(_vm.shippingDetails, \"telephone\", $$v)},expression:\"shippingDetails.telephone\"}})]}}],null,true)})],1):_vm._e(),_vm._v(\" \"),(!_vm.isAddNewAddressFormVisible)?_c('SfButton',{staticClass:\"color-light form__action-button form__action-button--add-address\",attrs:{\"type\":\"submit\"},on:{\"click\":_vm.handleAddNewAddressBtnClick}},[_vm._v(\"\\n      \"+_vm._s(_vm.$t('Add new address'))+\"\\n    \")]):_vm._e(),_vm._v(\" \"),_c('div',{staticClass:\"form\"},[_c('div',{staticClass:\"form__action\"},[(!(_vm.isShippingDetailsStepCompleted && !dirty))?_c('SfButton',{directives:[{name:\"e2e\",rawName:\"v-e2e\",value:('select-shipping'),expression:\"'select-shipping'\"}],staticClass:\"form__action-button\",attrs:{\"disabled\":_vm.isShippingLoading,\"type\":\"submit\"}},[_vm._v(\"\\n          \"+_vm._s(_vm.$t('Select shipping method'))+\"\\n        \")]):_vm._e()],1)]),_vm._v(\" \"),(_vm.isShippingDetailsStepCompleted && !dirty)?_c('VsfShippingProvider',{attrs:{\"shipping-methods\":_vm.shippingMethods},on:{\"submit\":function($event){_vm.$router.push(_vm.localeRoute({ name: 'billing' }))}}}):_vm._e()],1)]}}])})}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport {\n  SfHeading, SfInput, SfButton, SfSelect,\n} from '@storefront-ui/vue';\nimport {\n  ref,\n  computed,\n  onMounted,\n  defineComponent,\n  useRouter,\n  useContext,\n} from '@nuxtjs/composition-api';\nimport { required, min, digits } from 'vee-validate/dist/rules';\nimport { ValidationProvider, ValidationObserver, extend } from 'vee-validate';\nimport userShippingGetters from '~/modules/customer/getters/userShippingGetters';\nimport addressGetter from '~/modules/customer/getters/addressGetter';\nimport { useCountrySearch } from '~/composables';\nimport type {\n  Country, AvailableShippingMethod, CustomerAddress, Customer,\n} from '~/modules/GraphQL/types';\nimport useShipping from '~/modules/checkout/composables/useShipping';\nimport useUser from '~/modules/customer/composables/useUser';\nimport useUserAddress from '~/modules/customer/composables/useUserAddress';\nimport {\n  addressFromApiToForm, CheckoutAddressForm, findUserAddressIdenticalToSavedCartAddress, getInitialCheckoutAddressForm,\n} from '~/helpers/checkout/address';\nimport { mergeItem } from '~/helpers/asyncLocalStorage';\nimport { isPreviousStepValid } from '~/helpers/checkout/steps';\n\nextend('required', {\n  ...required,\n  message: 'This field is required',\n});\nextend('min', {\n  ...min,\n  message: 'The field should have at least {length} characters',\n});\nextend('digits', {\n  ...digits,\n  message: 'Please provide a valid phone number',\n});\n\nexport default defineComponent({\n  name: 'ShippingStep',\n  components: {\n    SfHeading,\n    SfInput,\n    SfButton,\n    SfSelect,\n    ValidationProvider,\n    ValidationObserver,\n    UserShippingAddresses: () => import('~/modules/checkout/components/UserShippingAddresses.vue'),\n    VsfShippingProvider: () => import('~/modules/checkout/components/VsfShippingProvider.vue'),\n  },\n  setup() {\n    const router = useRouter();\n    const { app } = useContext();\n    const userShipping = ref<Customer | null>(null);\n    const {\n      load: loadShipping,\n      save: saveShipping,\n      loading: isShippingLoading,\n    } = useShipping();\n    const {\n      load: loadUserShipping,\n      setDefaultAddress,\n    } = useUserAddress();\n\n    const {\n      load: loadCountries,\n      search: searchCountry,\n    } = useCountrySearch();\n    const countries = ref<Country[]>([]);\n    const country = ref<Country | null>(null);\n    const { isAuthenticated } = useUser();\n    const shippingDetails = ref<CheckoutAddressForm>(getInitialCheckoutAddressForm());\n    const shippingMethods = ref<AvailableShippingMethod[]>([]);\n    const currentAddressId = ref<number | null>(null);\n\n    const isSetAsDefaultRequested = ref(false);\n    const isFormSubmitted = ref(false);\n    const isAddNewAddressFormVisible = ref(true);\n\n    const isShippingDetailsStepCompleted = ref(false);\n    const addresses = computed(() => userShippingGetters.getAddresses(userShipping.value));\n\n    const canMoveForward = computed(() => !isShippingLoading.value && shippingDetails.value && Object.keys(\n      shippingDetails.value,\n    ).length > 0);\n\n    const hasSavedShippingAddress = computed(() => {\n      if (!isAuthenticated.value || !userShipping.value) {\n        return false;\n      }\n      return addresses.value.length > 0;\n    });\n\n    const countriesList = computed(() => addressGetter.countriesList(countries.value));\n\n    const regionInformation = computed(() => addressGetter.regionList(country.value));\n\n    const handleAddressSubmit = (reset: () => void) => async () => {\n      const addressId = currentAddressId.value;\n      const shippingDetailsData = {\n        ...shippingDetails.value,\n        customerAddressId: addressId,\n        save_in_address_book: false,\n      };\n      await mergeItem('checkout', { shipping: shippingDetailsData });\n\n      const shippingInfo = await saveShipping({ shippingDetails: shippingDetailsData });\n      shippingMethods.value = shippingInfo?.available_shipping_methods ?? [];\n\n      if (addressId !== null && isSetAsDefaultRequested.value) {\n        const [chosenAddress] = userShippingGetters.getAddresses(\n          userShipping.value,\n          { id: addressId },\n        );\n        chosenAddress.default_shipping = isSetAsDefaultRequested.value;\n        if (chosenAddress) {\n          await setDefaultAddress({ address: chosenAddress });\n          userShipping.value = await loadUserShipping(true);\n        }\n      }\n      reset();\n      isShippingDetailsStepCompleted.value = true;\n    };\n\n    const handleAddNewAddressBtnClick = () => {\n      currentAddressId.value = null;\n      shippingDetails.value = getInitialCheckoutAddressForm();\n      isAddNewAddressFormVisible.value = true;\n      isShippingDetailsStepCompleted.value = false;\n    };\n\n    const handleSetCurrentAddress = async (customerAddress: CustomerAddress) => {\n      const id = customerAddress?.id;\n      currentAddressId.value = id;\n      if (id) {\n        isAddNewAddressFormVisible.value = false;\n      }\n      shippingDetails.value = addressFromApiToForm(customerAddress);\n      country.value = customerAddress.country_code ? await searchCountry({ id: customerAddress.country_code }) : null;\n      isShippingDetailsStepCompleted.value = false;\n    };\n\n    const changeShippingDetails = (field: keyof CheckoutAddressForm, value: string) => {\n      shippingDetails.value[field] = value;\n      isShippingDetailsStepCompleted.value = false;\n      currentAddressId.value = null;\n    };\n\n    const changeCountry = async (id: string) => {\n      changeShippingDetails('country_code', id);\n      const newCountry = await searchCountry({ id });\n      shippingDetails.value.region = '';\n      country.value = newCountry;\n    };\n\n    onMounted(async () => {\n      const validStep = await isPreviousStepValid('user-account');\n      if (!validStep) {\n        await router.push(app.localeRoute({ name: 'user-account' }));\n      }\n      const [loadedShippingInfoBoundToCart, loadedUserShipping, loadedCountries] = await Promise.all([\n        loadShipping(),\n        loadUserShipping(),\n        loadCountries(),\n      ]);\n      const [defaultAddress = null] = userShippingGetters.getAddresses(loadedUserShipping, { default_shipping: true });\n      const wasShippingAddressAlreadySetOnCart = Boolean(loadedShippingInfoBoundToCart);\n\n      if (wasShippingAddressAlreadySetOnCart) {\n        const userAddressIdenticalToSavedCartAddress = findUserAddressIdenticalToSavedCartAddress(\n          loadedUserShipping?.addresses,\n          loadedShippingInfoBoundToCart,\n        );\n        handleSetCurrentAddress({ ...loadedShippingInfoBoundToCart, id: userAddressIdenticalToSavedCartAddress?.id });\n      } else if (defaultAddress) {\n        handleSetCurrentAddress(defaultAddress);\n      }\n      if (shippingDetails.value?.country_code) {\n        country.value = await searchCountry({ id: shippingDetails.value.country_code });\n      }\n      userShipping.value = loadedUserShipping;\n      countries.value = loadedCountries;\n    });\n\n    return {\n      isAddNewAddressFormVisible,\n      canMoveForward,\n      changeCountry,\n      changeShippingDetails,\n      countries,\n      countriesList,\n      country,\n      currentAddressId,\n      handleAddNewAddressBtnClick,\n      handleAddressSubmit,\n      handleSetCurrentAddress,\n      hasSavedShippingAddress,\n      isAuthenticated,\n      isFormSubmitted,\n      isShippingDetailsStepCompleted,\n      isShippingLoading,\n      regionInformation,\n      searchCountry,\n      isSetAsDefaultRequested,\n      shippingDetails,\n      shippingMethods,\n      addresses,\n    };\n  },\n});\n","import mod from \"-!../../../../node_modules/babel-loader/lib/index.js??ref--13-0!../../../../node_modules/ts-loader/index.js??ref--13-1!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../../../node_modules/unplugin/dist/webpack/loaders/transform.js??ref--15-0!./Shipping.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../node_modules/babel-loader/lib/index.js??ref--13-0!../../../../node_modules/ts-loader/index.js??ref--13-1!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../../../node_modules/unplugin/dist/webpack/loaders/transform.js??ref--15-0!./Shipping.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./Shipping.vue?vue&type=template&id=4120bf6e&scoped=true&\"\nimport script from \"./Shipping.vue?vue&type=script&lang=ts&\"\nexport * from \"./Shipping.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./Shipping.vue?vue&type=style&index=0&id=4120bf6e&prod&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"4120bf6e\",\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}